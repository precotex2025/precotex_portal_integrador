<div class="laboratorio-container">

  <button mat-icon-button (click)="toggleRecetas()" class="toggle-recetas-btn">
    <mat-icon>{{ showRecetas ? 'chevron_left' : 'menu' }}</mat-icon>
  </button>

  <div class="recetas-sidebar" [class.visible]="showRecetas" [class.oculto]="!showRecetas">
    <h3>Recetas disponibles</h3>
    <mat-nav-list>
      <mat-list-item *ngFor="let receta of recetas" 
      (click)="seleccionarReceta(receta)"
      [ngClass]="{ 'receta-activa': receta === recetaSeleccionada }">
        <h4 matLine>{{ receta }}</h4>
      </mat-list-item>
    </mat-nav-list>
  </div>

  <div class="contenido-principal" [class.expandido]="!showRecetas" [class.reducido]="showRecetas">

    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>Información:</mat-panel-title>
        <mat-panel-description>#{{sdcData.sdc}} - Cliente: {{ sdcData.cliente }} - Color: {{ sdcData.color }}</mat-panel-description>
      </mat-expansion-panel-header>

      <div class="sdc-grid">
        <div><strong>Fecha Apertura:</strong> {{ sdcData.fechaApertura | date:'dd/MM/yyyy' }}</div>
        <div><strong>Fecha Entrega:</strong> {{ sdcData.fechaEntrega | date:'dd/MM/yyyy' }}</div>
        <div><strong>Tipo:</strong> {{ sdcData.tipo }}</div>
        <div><strong>Artículo:</strong> {{ sdcData.articulo }}</div>
      </div>
    </mat-expansion-panel>

    <div class="botones-acciones">
      <button mat-raised-button color="primary">Informe SDC</button>
      <button mat-raised-button color="accent" (click)="onAgregarOpcion()">Agregar opción</button>
      <button mat-raised-button style="background-color: green; color: white;">Entregar</button>
      <button mat-raised-button color="warn">Quitar</button>
      <button mat-raised-button color="primary">Actualizar</button>
    </div>

    <div class="tabla-wrapper">
      <section class="formulaciones-section">
        <div class="formulaciones-scroll-wrapper">
          <div class="formulaciones-grid" [ngStyle]="{ 'grid-template-columns': '2fr ' + '1fr '.repeat(formulaciones.length).trim() }">
            
            <div class="" style="background-color: #f4f6f9;"></div>
            <div class="formulacion-cell" *ngFor="let f of formulaciones; let i = index">
              <button mat-button color="accent" (click)="copiarFormulacion(i)">
                <mat-icon>file_copy</mat-icon>
              </button>
            </div>

            <div class="" style="background-color: #f4f6f9;"></div>
            <div class="formulacion-cell" *ngFor="let f of formulaciones; let i = index">
              <button mat-button color="primary">
                Enviar a Autolab <mat-icon>send</mat-icon>
              </button>
            </div>

            <div class="formulacion-header">NOM COLORANTE</div>
            <div class="formulacion-header" *ngFor="let f of formulaciones">{{ f.numeroColumna }}</div>

            <ng-container *ngFor="let fila of filas">
              <div class="formulacion-cell etiqueta">{{ fila.etiqueta }}</div>
              <div class="formulacion-cell" *ngFor="let f of formulaciones">

                <ng-container [ngSwitch]="fila.tipo">
                  <ng-container *ngIf="fila.key === 'detalle'; else valorNormal">
                    <button mat-button color="primary" (click)="verDetalle(f)">
                      VER
                    </button>
                  </ng-container>
                  <ng-template #valorNormal>
                    <span *ngSwitchCase="'texto'">{{ getValor(f, fila.key) }}</span>
                    <span *ngSwitchCase="'numero'">{{ getValor(f, fila.key) | number:'1.4-4' }}</span>
                    <span *ngSwitchCase="'booleano'">
                      <mat-icon color="primary" *ngIf="getValor(f, fila.key)">check</mat-icon>
                    </span>
                  </ng-template>
                </ng-container>
              </div>
              
            </ng-container>
            <div class="formulacion-cell etiqueta">Acción</div>
              <div class="formulacion-cell" *ngFor="let f of formulaciones; let i = index">
              <button mat-button color="warn" (click)="borrarFormulacion(i)">
                <mat-icon>delete</mat-icon>
              </button>
            </div>
          </div>
        </div>
      </section>
    </div>

  </div>
</div>
